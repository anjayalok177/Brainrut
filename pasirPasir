-- ======================
-- Intro animation
-- ======================
local function createIntroAnimation()
    local TweenService = game:GetService("TweenService")
    local SoundService = game:GetService("SoundService")
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "IntroScreen"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = game:GetService("CoreGui")
    
    -- Create sounds
    local laserSound = Instance.new("Sound")
    laserSound.SoundId = "rbxassetid://9057675920"
    laserSound.Volume = 0.5
    laserSound.Parent = SoundService
    
    local explosionSound = Instance.new("Sound")
    explosionSound.SoundId = "rbxassetid://112797079504478"
    explosionSound.Volume = 0.6
    explosionSound.Parent = SoundService
    
    -- Animated Background with gradient
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.Position = UDim2.new(0, 0, 0, 0)
    background.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    background.BorderSizePixel = 0
    background.Parent = screenGui
    
    -- Gradient background
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 20, 50)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(15, 10, 30)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 30, 70))
    }
    gradient.Rotation = 45
    gradient.Parent = background
    
    -- Animated particles in background
    for i = 1, 20 do
        local bgParticle = Instance.new("Frame")
        bgParticle.Size = UDim2.new(0, math.random(3, 8), 0, math.random(3, 8))
        bgParticle.Position = UDim2.new(math.random(), 0, math.random(), 0)
        bgParticle.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
        bgParticle.BackgroundTransparency = math.random(50, 80) / 100
        bgParticle.BorderSizePixel = 0
        bgParticle.Parent = background
        
        local bgCorner = Instance.new("UICorner")
        bgCorner.CornerRadius = UDim.new(1, 0)
        bgCorner.Parent = bgParticle
        
        -- Float animation
        task.spawn(function()
            while bgParticle.Parent do
                local floatAnim = TweenService:Create(
                    bgParticle,
                    TweenInfo.new(math.random(20, 40) / 10, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
                    {
                        Position = UDim2.new(
                            bgParticle.Position.X.Scale + math.random(-10, 10) / 100,
                            0,
                            bgParticle.Position.Y.Scale + math.random(-10, 10) / 100,
                            0
                        )
                    }
                )
                floatAnim:Play()
                task.wait(math.random(20, 40) / 10)
            end
        end)
    end
    
    -- Main Image Frame (Square) - Centered
    local imageFrame = Instance.new("ImageLabel")
    imageFrame.Size = UDim2.new(0, 220, 0, 220)
    imageFrame.Position = UDim2.new(0.5, 0, 1.2, 0)
    imageFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    imageFrame.BackgroundTransparency = 1
    imageFrame.Image = "rbxassetid://110843044052526"
    imageFrame.ScaleType = Enum.ScaleType.Fit
    imageFrame.Parent = background
    
    -- Rounded corners
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 25)
    corner.Parent = imageFrame
    
    -- Glow effect around image
    local glow = Instance.new("ImageLabel")
    glow.Size = UDim2.new(1.3, 0, 1.3, 0)
    glow.Position = UDim2.new(0.5, 0, 0.5, 0)
    glow.AnchorPoint = Vector2.new(0.5, 0.5)
    glow.BackgroundTransparency = 1
    glow.Image = "rbxassetid://5028857084"
    glow.ImageColor3 = Color3.fromRGB(138, 43, 226)
    glow.ImageTransparency = 0.5
    glow.Parent = imageFrame
    
    -- Title text - MOVED MUCH LOWER
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(0, 500, 0, 70)
    title.Position = UDim2.new(0.5, 0, 0.78, 0)
    title.AnchorPoint = Vector2.new(0.5, 0.5)
    title.BackgroundTransparency = 1
    title.Text = "YI DA MU SAKE"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 48
    title.Font = Enum.Font.GothamBold
    title.TextTransparency = 1
    title.TextStrokeTransparency = 0.5
    title.TextStrokeColor3 = Color3.fromRGB(138, 43, 226)
    title.Parent = background
    
    -- ANIMATION 1: Slide up from bottom with smooth BOUNCE effect (2.5 SECONDS)
    local slideUp = TweenService:Create(
        imageFrame,
        TweenInfo.new(2.5, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
        {Position = UDim2.new(0.5, 0, 0.4, 0)}
    )
    
    -- ANIMATION 2: Fade in text
    local fadeInTitle = TweenService:Create(
        title,
        TweenInfo.new(0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {TextTransparency = 0}
    )
    
    -- Start animations + LASER SOUND
    laserSound:Play()
    slideUp:Play()
    task.wait(1.2)
    fadeInTitle:Play()
    
    -- Wait for bounce to settle completely
    task.wait(2.0)
    
    -- Calculate distance from center for OUTSIDE-IN shatter
    local function getDistanceFromCenter(row, col, gridSize)
        local centerRow = (gridSize - 1) / 2
        local centerCol = (gridSize - 1) / 2
        local distRow = row - centerRow
        local distCol = col - centerCol
        return math.sqrt(distRow * distRow + distCol * distCol)
    end
    
    -- SHATTER FROM OUTSIDE TO INSIDE
    local function createShatteredPieces()
        local pieces = {}
        local gridSize = 6
        local imageSize = 220
        local pieceSize = imageSize / gridSize
        local originalImageSize = 420
        
        local piecesWithDistance = {}
        
        for row = 0, gridSize - 1 do
            for col = 0, gridSize - 1 do
                local piece = Instance.new("ImageLabel")
                
                piece.Size = UDim2.new(0, pieceSize, 0, pieceSize)
                piece.Position = UDim2.new(
                    0.5, (col * pieceSize) - (imageSize / 2),
                    0.4, (row * pieceSize) - (imageSize / 2)
                )
                piece.AnchorPoint = Vector2.new(0, 0)
                
                piece.BackgroundTransparency = 1
                piece.Image = "rbxassetid://110843044052526"
                piece.ScaleType = Enum.ScaleType.Crop
                piece.ZIndex = 5
                
                local rectWidth = originalImageSize / gridSize
                local rectHeight = originalImageSize / gridSize
                
                piece.ImageRectSize = Vector2.new(rectWidth, rectHeight)
                piece.ImageRectOffset = Vector2.new(col * rectWidth, row * rectHeight)
                
                piece.Parent = background
                
                local pCorner = Instance.new("UICorner")
                pCorner.CornerRadius = UDim.new(0, math.random(2, 6))
                pCorner.Parent = piece
                
                local distance = getDistanceFromCenter(row, col, gridSize)
                
                table.insert(piecesWithDistance, {
                    piece = piece,
                    distance = distance
                })
            end
        end
        
        table.sort(piecesWithDistance, function(a, b)
            return a.distance > b.distance
        end)
        
        return piecesWithDistance
    end
    
    local function createTotemParticles()
        local particles = {}
        
        for i = 1, 45 do
            local particle = Instance.new("Frame")
            local size = math.random(10, 22)
            particle.Size = UDim2.new(0, size, 0, size)
            particle.Position = UDim2.new(0.5, 0, 0.4, 0)
            particle.AnchorPoint = Vector2.new(0.5, 0.5)
            
            local colorChoice = math.random(1, 4)
            if colorChoice == 1 then
                particle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            elseif colorChoice == 2 then
                particle.BackgroundColor3 = Color3.fromRGB(255, 255, 120)
            elseif colorChoice == 3 then
                particle.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
            else
                particle.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
            end
            
            particle.BorderSizePixel = 0
            particle.ZIndex = 6
            particle.Parent = background
            
            local pCorner = Instance.new("UICorner")
            pCorner.CornerRadius = UDim.new(0.35, 0)
            pCorner.Parent = particle
            
            table.insert(particles, particle)
        end
        
        return particles
    end
    
    local flash = Instance.new("Frame")
    flash.Size = UDim2.new(1, 0, 1, 0)
    flash.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    flash.BorderSizePixel = 0
    flash.BackgroundTransparency = 1
    flash.ZIndex = 10
    flash.Parent = background
    
    local flashIn = TweenService:Create(
        flash,
        TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0.1}
    )
    
    local flashOut = TweenService:Create(
        flash,
        TweenInfo.new(0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
        {BackgroundTransparency = 1}
    )
    
    imageFrame.Visible = false
    glow.Visible = false
    
    explosionSound:Play()
    
    flashIn:Play()
    flashIn.Completed:Connect(function()
        flashOut:Play()
    end)
    
    local shatteredPieces = createShatteredPieces()
    local totemParts = createTotemParticles()
    
    for i, pieceData in ipairs(shatteredPieces) do
        local piece = pieceData.piece
        
        local angle = math.random(0, 360)
        local rad = math.rad(angle)
        local distance = math.random(400, 800)
        
        local targetX = math.cos(rad) * distance
        local targetY = math.sin(rad) * distance + math.random(100, 300)
        
        local scatter = TweenService:Create(
            piece,
            TweenInfo.new(
                2.0,
                Enum.EasingStyle.Quad,
                Enum.EasingDirection.Out
            ),
            {
                Position = UDim2.new(piece.Position.X.Scale, piece.Position.X.Offset + targetX, 
                                   piece.Position.Y.Scale, piece.Position.Y.Offset + targetY),
                ImageTransparency = 1,
                Rotation = math.random(-450, 450),
                Size = UDim2.new(0, piece.Size.X.Offset * 0.3, 0, piece.Size.Y.Offset * 0.3)
            }
        )
        
        scatter:Play()
        
        if i <= #totemParts then
            local totemParticle = totemParts[i]
            
            local tAngle = math.random(0, 360)
            local tRad = math.rad(tAngle)
            local tDistance = math.random(350, 750)
            
            local tTargetX = math.cos(tRad) * tDistance
            local tTargetY = math.sin(tRad) * tDistance + math.random(120, 280)
            
            local totemScatter = TweenService:Create(
                totemParticle,
                TweenInfo.new(
                    2.0,
                    Enum.EasingStyle.Quad,
                    Enum.EasingDirection.Out
                ),
                {
                    Position = UDim2.new(0.5, tTargetX, 0.4, tTargetY),
                    BackgroundTransparency = 1,
                    Rotation = math.random(-280, 280),
                    Size = UDim2.new(0, totemParticle.Size.X.Offset * 0.25, 0, totemParticle.Size.Y.Offset * 0.25)
                }
            )
            
            totemScatter:Play()
        end
        
        task.wait(0.004)
    end
    
    task.wait(1.5)
    
    local fadeOutTitle = TweenService:Create(title, TweenInfo.new(0.5), {TextTransparency = 1})
    local fadeOutBg = TweenService:Create(background, TweenInfo.new(0.5), {BackgroundTransparency = 1})
    
    fadeOutTitle:Play()
    fadeOutBg:Play()
    
    task.wait(0.6)
    
    laserSound:Destroy()
    explosionSound:Destroy()
    
    screenGui:Destroy()
end

createIntroAnimation()

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

local Options = Library.Options
local Toggles = Library.Toggles

local Window = Library:CreateWindow({
    Title = "Yi Da Mu Sake",
    Footer = "version: Game pasir pasir",
    Icon = 110843044052526,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

local Tabs = {
    Main = Window:AddTab("Main", "home"),
    Teleport = Window:AddTab("Taliportasi", "map-pin"),
    ["UI Settings"] = Window:AddTab("UI Settings", "settings"),
}

-- ==================== MAIN TAB ====================

local SpeedBox = Tabs.Main:AddLeftGroupbox("Speed")

SpeedBox:AddSlider("WalkSpeed", {
    Text = "Speed",
    Default = 16,
    Min = 1,
    Max = 1000,
    Rounding = 0,
    Suffix = " speed",
})

local speedEnabled = false

SpeedBox:AddToggle("EnableSpeed", {
    Text = "Enable Speed",
    Default = false,
    Callback = function(Value)
        speedEnabled = Value
        if not Value and player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = 16
        end
    end,
})

task.spawn(function()
    while task.wait() do
        pcall(function()
            if speedEnabled and player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.WalkSpeed = Options.WalkSpeed.Value
            end
        end)
    end
end)

-- ==================== AUTO COLLECT ====================

local AutoCollectBox = Tabs.Main:AddRightGroupbox("Auto Collect")

local playerBaseNumber = nil
local collectCount = 0

local function findPlayerBase()
    local bases = workspace:FindFirstChild("GameAssets")
    if not bases then return nil end
    
    bases = bases:FindFirstChild("Bases")
    if not bases then return nil end
    
    for i = 1, 5 do
        local base = bases:FindFirstChild(tostring(i))
        if base then
            local baseData = base:FindFirstChild("BaseData")
            if baseData then
                local owner = baseData:FindFirstChild("Owner")
                if owner and owner:IsA("ObjectValue") then
                    if owner.Value == player then
                        return i
                    end
                end
            end
        end
    end
    
    return nil
end

local function collectFromBase()
    if not playerBaseNumber then
        playerBaseNumber = findPlayerBase()
        if not playerBaseNumber then
            return false
        end
    end
    
    local base = workspace.GameAssets.Bases:FindFirstChild(tostring(playerBaseNumber))
    if not base then return false end
    
    local entityLocations = base:FindFirstChild("EntityLocations")
    if not entityLocations then return false end
    
    local char = player.Character
    if not char then return false end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end
    
    collectCount = 0
    
    -- Floor1: 1-10
    local floor1 = entityLocations:FindFirstChild("Floor1")
    if floor1 then
        for i = 1, 10 do
            local entity = floor1:FindFirstChild(tostring(i))
            if entity then
                local collectionZone = entity:FindFirstChild("CollectionZone")
                if collectionZone then
                    local hitbox = collectionZone:FindFirstChild("Hitbox")
                    if hitbox then
                        pcall(function()
                            firetouchinterest(hrp, hitbox, 0)
                            firetouchinterest(hrp, hitbox, 1)
                            collectCount = collectCount + 1
                        end)
                        task.wait(0.1)
                    end
                end
            end
        end
    end
    
    -- Floor2: 11-20
    local floor2 = entityLocations:FindFirstChild("Floor2")
    if floor2 then
        for i = 11, 20 do
            local entity = floor2:FindFirstChild(tostring(i))
            if entity then
                local collectionZone = entity:FindFirstChild("CollectionZone")
                if collectionZone then
                    local hitbox = collectionZone:FindFirstChild("Hitbox")
                    if hitbox then
                        pcall(function()
                            firetouchinterest(hrp, hitbox, 0)
                            firetouchinterest(hrp, hitbox, 1)
                            collectCount = collectCount + 1
                        end)
                        task.wait(0.1)
                    end
                end
            end
        end
    end
    
    -- Floor3: 21-30
    local floor3 = entityLocations:FindFirstChild("Floor3")
    if floor3 then
        for i = 21, 30 do
            local entity = floor3:FindFirstChild(tostring(i))
            if entity then
                local collectionZone = entity:FindFirstChild("CollectionZone")
                if collectionZone then
                    local hitbox = collectionZone:FindFirstChild("Hitbox")
                    if hitbox then
                        pcall(function()
                            firetouchinterest(hrp, hitbox, 0)
                            firetouchinterest(hrp, hitbox, 1)
                            collectCount = collectCount + 1
                        end)
                        task.wait(0.1)
                    end
                end
            end
        end
    end
    
    return true
end

local CollectStatusLabel = AutoCollectBox:AddLabel("Status: Idle")
local CollectCountLabel = AutoCollectBox:AddLabel("Collected: 0")

AutoCollectBox:AddToggle("AutoCollect", {
    Text = "Enable Auto Collect",
    Default = false,
})

task.spawn(function()
    while task.wait(0.1) do
        if Toggles.AutoCollect and Toggles.AutoCollect.Value then
            if not playerBaseNumber then
                CollectStatusLabel:SetText("Status: Finding base...")
                playerBaseNumber = findPlayerBase()
                
                if playerBaseNumber then
                    CollectStatusLabel:SetText("Status: Found Base " .. playerBaseNumber)
                    Library:Notify("Found your base: Base " .. playerBaseNumber)
                else
                    CollectStatusLabel:SetText("Status: Base not found!")
                    task.wait(5)
                end
            else
                CollectStatusLabel:SetText("Status: Collecting...")
                
                if collectFromBase() then
                    CollectCountLabel:SetText("Collected: " .. collectCount .. " items")
                    CollectStatusLabel:SetText("Status: Cycle complete")
                    task.wait(1)
                else
                    CollectStatusLabel:SetText("Status: Collection failed")
                    task.wait(2)
                end
            end
        else
            CollectStatusLabel:SetText("Status: Idle")
            playerBaseNumber = nil
        end
    end
end)

-- ==================== TELEPORT TAB ====================

local TeleBrainrotBox = Tabs.Teleport:AddLeftGroupbox("Tele to brainrut")

local brainrotList = {}
local selectedBrainrot = nil

local function scanBrainrots()
    brainrotList = {}
    
    local gameAssets = workspace:FindFirstChild("GameAssets")
    if not gameAssets then 
        Library:Notify("GameAssets not found!")
        return 
    end
    
    local entities = gameAssets:FindFirstChild("Entities")
    if not entities then 
        Library:Notify("Entities not found!")
        return 
    end
    
    for i = 1, 11 do
        local zone = entities:FindFirstChild("Zone" .. i)
        if zone then
            for _, brainrot in pairs(zone:GetChildren()) do
                if brainrot:IsA("Model") or brainrot:IsA("Part") or brainrot:IsA("Folder") then
                    table.insert(brainrotList, {
                        name = brainrot.Name,
                        zone = "Zone" .. i,
                        object = brainrot
                    })
                end
            end
        end
    end
    
    return brainrotList
end

local brainrotNames = {}
local function updateBrainrotDropdown()
    brainrotNames = {}
    scanBrainrots()
    
    if #brainrotList == 0 then
        brainrotNames = {"No brainrots found"}
    else
        for _, brainrot in pairs(brainrotList) do
            table.insert(brainrotNames, brainrot.zone .. " - " .. brainrot.name)
        end
    end
    
    Options.BrainrotSelect:SetValues(brainrotNames)
    if #brainrotNames > 0 then
        Options.BrainrotSelect:SetValue(brainrotNames[1])
    end
end

TeleBrainrotBox:AddDropdown("BrainrotSelect", {
    Values = {"Click 'Refresh' to load"},
    Default = 1,
    Multi = false,
    Text = "Select Brainrot",
    Tooltip = "Choose which brainrot to teleport to",
    Searchable = true,
    
    Callback = function(Value)
        for _, brainrot in pairs(brainrotList) do
            local displayName = brainrot.zone .. " - " .. brainrot.name
            if displayName == Value then
                selectedBrainrot = brainrot
                break
            end
        end
    end,
})

TeleBrainrotBox:AddButton({
    Text = "Refresh",
    Func = function()
        updateBrainrotDropdown()
        Library:Notify("Found " .. #brainrotList .. " brainrots")
    end,
    Tooltip = "Scan for all brainrots in Zone 1-11",
})

TeleBrainrotBox:AddButton({
    Text = "Tele",
    Func = function()
        if not selectedBrainrot then
            Library:Notify("Please select a brainrot first!")
            return
        end
        
        local success = pcall(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local brainrotObj = selectedBrainrot.object
                
                local targetPos
                if brainrotObj:IsA("Model") then
                    local primaryPart = brainrotObj.PrimaryPart or brainrotObj:FindFirstChildWhichIsA("BasePart")
                    if primaryPart then
                        targetPos = primaryPart.Position
                    end
                elseif brainrotObj:IsA("BasePart") then
                    targetPos = brainrotObj.Position
                end
                
                if targetPos then
                    player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPos + Vector3.new(0, 5, 0))
                    Library:Notify("Teleported to " .. selectedBrainrot.name)
                else
                    Library:Notify("Could not find position!")
                end
            end
        end)
        
        if not success then
            Library:Notify("Failed to teleport!")
        end
    end,
    Tooltip = "Teleport to selected brainrot",
})

local BalekBox = Tabs.Teleport:AddRightGroupbox("Balek umah")

BalekBox:AddButton({
    Text = "Balek",
    Func = function()
        local success = pcall(function()
            if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
                Library:Notify("Character not found!")
                return
            end
            
            -- Find player's base first
            local baseNum = findPlayerBase()
            if not baseNum then
                Library:Notify("Your base not found!")
                return
            end
            
            -- Get the base
            local base = workspace.GameAssets.Bases:FindFirstChild(tostring(baseNum))
            if not base then
                Library:Notify("Base " .. baseNum .. " not found!")
                return
            end
            
            -- Navigate to Floor1["1"]
            local entityLocations = base:FindFirstChild("EntityLocations")
            if not entityLocations then
                Library:Notify("EntityLocations not found!")
                return
            end
            
            local floor1 = entityLocations:FindFirstChild("Floor1")
            if not floor1 then
                Library:Notify("Floor1 not found!")
                return
            end
            
            local location1 = floor1:FindFirstChild("1")
            if not location1 then
                Library:Notify("Location 1 not found!")
                return
            end
            
            -- Get position from the location
            local targetPos
            if location1:IsA("Model") then
                local primaryPart = location1.PrimaryPart or location1:FindFirstChildWhichIsA("BasePart")
                if primaryPart then
                    targetPos = primaryPart.Position
                end
            elseif location1:IsA("BasePart") then
                targetPos = location1.Position
            end
            
            if targetPos then
                player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPos + Vector3.new(0, 5, 0))
                Library:Notify("Balek umah! (Base " .. baseNum .. ")")
            else
                Library:Notify("Could not find position!")
            end
        end)
        
        if not success then
            Library:Notify("Failed to teleport home!")
        end
    end,
    Tooltip = "Teleport to your base (Floor1, position 1)",
})

-- ==================== UI SETTINGS ====================

ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({"MenuKeybind"})
ThemeManager:SetFolder("Yi Da Mu Sake")
SaveManager:SetFolder("Yi Da Mu Sake/configs")
SaveManager:BuildConfigSection(Tabs["UI Settings"])
ThemeManager:ApplyToTab(Tabs["UI Settings"])
SaveManager:LoadAutoloadConfig()

Library:Notify("Yi Da Mu Sake loaded!")
